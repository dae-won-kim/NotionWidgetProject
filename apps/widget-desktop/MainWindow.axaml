<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:WidgetDesktop.Models"
        xmlns:conv="clr-namespace:WidgetDesktop.Converters"
        x:Class="WidgetDesktop.MainWindow"
        Width="360" Height="560"
        Topmost="True"
        Title="Checklist Widget">

  <Window.Resources>
    <conv:NotionColorToBrushConverter x:Key="NotionColorToBrushConverter"/>
  </Window.Resources>

  <Window.Styles>
    <Style Selector="Border.row">
      <Setter Property="CornerRadius" Value="999"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="#E0E0E0"/>
      <Setter Property="Background" Value="#F7F7F7"/>
    </Style>

    <Style Selector="Border.row:pointerover">
      <Setter Property="Background" Value="#22FFFFFF"/>
    </Style>

    <Style Selector="Border.drag-handle">
      <Setter Property="Width" Value="18"/>
      <Setter Property="Padding" Value="2,0"/>
      <Setter Property="Margin" Value="0,0,10,0"/>
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="Cursor" Value="SizeAll"/>
      <Setter Property="VerticalAlignment" Value="Stretch"/>
      <Setter Property="HorizontalAlignment" Value="Left"/>
    </Style>

    <Style Selector="TextBlock.drag-handle-text">
      <Setter Property="FontSize" Value="11"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Foreground" Value="#9A9A9A"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
      <Setter Property="HorizontalAlignment" Value="Center"/>
    </Style>

    <Style Selector="Button.status">
      <Setter Property="CornerRadius" Value="999"/>
      <Setter Property="Padding" Value="10,4"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Focusable" Value="False"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="Opacity" Value="1"/>
    </Style>

    <Style Selector="Button.status.hover">
      <Setter Property="Opacity" Value="0.90"/>
    </Style>

    <Style Selector="Button.status.pressed">
      <Setter Property="Opacity" Value="0.78"/>
    </Style>
  </Window.Styles>

  <Border Padding="12"
          CornerRadius="16"
          PointerPressed="WindowDragArea_PointerPressed">

    <DockPanel>

      <TextBlock DockPanel.Dock="Top"
                 Text="Checklist"
                 FontSize="18"
                 FontWeight="Bold"
                 Margin="0,0,0,12"/>

      <!-- Error display -->
      <TextBlock Name="ErrorText"
                 DockPanel.Dock="Top"
                 IsVisible="False"
                 TextWrapping="Wrap"
                 Foreground="Red"
                 Margin="0,0,0,12"/>

      <ListBox Name="TodoItems"
               BorderThickness="0"
               MinHeight="200"
               PointerReleased="List_PointerReleased">
        <ListBox.ItemTemplate>
          <DataTemplate x:DataType="models:ItemDto">
            <Border Classes="row"
                    Padding="12"
                    Margin="0,0,0,8"
                    PointerMoved="Row_PointerMoved"
                    PointerReleased="Row_PointerReleased">
              <DockPanel>
                <!-- Drag handle -->
                <Border Classes="drag-handle"
                        DockPanel.Dock="Left"
                        PointerPressed="DragHandle_PointerPressed">
                  <TextBlock Classes="drag-handle-text"
                             Text="|||"/>
                </Border>

                <!-- Status button -->
                <Button Classes="status"
                        DockPanel.Dock="Right"
                        Background="{Binding StatusColor,
                          Converter={StaticResource NotionColorToBrushConverter}}"
                        Content="{Binding Status}"
                        Click="StatusButton_Click"
                        PointerEntered="StatusButton_PointerEntered"
                        PointerExited="StatusButton_PointerExited"
                        PointerPressed="StatusButton_PointerPressed"
                        PointerReleased="StatusButton_PointerReleased"/>

                <TextBlock Text="{Binding Title}"
                           TextWrapping="Wrap"
                           Foreground="Black"
                           Margin="0,0,10,0"/>
              </DockPanel>
            </Border>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>

    </DockPanel>
  </Border>
</Window>

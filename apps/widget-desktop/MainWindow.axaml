<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:WidgetDesktop.Models"
        xmlns:conv="clr-namespace:WidgetDesktop.Converters"
        x:Class="WidgetDesktop.MainWindow"
        Width="360" Height="560"
        Topmost="True"
        Title="Checklist Widget">

  <!-- ✅ 리소스는 Window 내부에만 -->
  <Window.Resources>
    <conv:NotionColorToBrushConverter x:Key="NotionColorToBrushConverter"/>
  </Window.Resources>

  <!-- ✅ Styles도 Window 내부에만 -->
  <Window.Styles>

    <Style Selector="Border.row">
      <Setter Property="CornerRadius" Value="999"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="#E0E0E0"/>
      <Setter Property="Background" Value="#F7F7F7"/>
    </Style>

    <Style Selector="Border.row:pointerover">
      <Setter Property="Background" Value="#22FFFFFF"/>
    </Style>

    <Style Selector="Button.status">
      <Setter Property="CornerRadius" Value="999"/>
      <Setter Property="Padding" Value="10,4"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Focusable" Value="False"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="Opacity" Value="1"/>
    </Style>

    <Style Selector="Button.status:pointerover">
      <Setter Property="Opacity" Value="0.90"/>
    </Style>

    <Style Selector="Button.status:pressed">
      <Setter Property="Opacity" Value="0.78"/>
    </Style>

  </Window.Styles>

  <Border Padding="12"
          CornerRadius="16"
          PointerPressed="WindowDragArea_PointerPressed">

    <DockPanel>

      <TextBlock DockPanel.Dock="Top"
                 Text="Checklist"
                 FontSize="18"
                 FontWeight="Bold"
                 Margin="0,0,0,12"/>

      <!-- ✅ DEBUG: 이 문구가 보이면 최신 XAML이 로드된 것 -->
      <TextBlock DockPanel.Dock="Top"
                 Text="(DEBUG) XAML LOADED"
                 Opacity="0.7"
                 Margin="0,0,0,8"/>

      <!-- 로딩/에러 표시 -->
      <TextBlock Name="ErrorText"
                 DockPanel.Dock="Top"
                 IsVisible="True"
                 TextWrapping="Wrap"
                 Background="#FFFFCC"
                 Foreground="Black"
                 Margin="0,0,0,12"/>

      <ListBox Name="TodoItems"
               BorderThickness="0"
               Background="#10FF0000"
               MinHeight="200">
        <ListBox.ItemTemplate>
          <DataTemplate x:DataType="models:ItemDto">

      <!-- 체크리스트 한 줄 -->
      <Border Classes="row"
              Padding="12"
              Margin="0,0,0,8"
              PointerPressed="Row_PointerPressed"
              PointerMoved="Row_PointerMoved"
              PointerReleased="Row_PointerReleased">

        <DockPanel>

          <!-- ✅ DEBUG: 템플릿이 실제로 렌더링되면 이 글자가 반드시 보임 -->
          <TextBlock DockPanel.Dock="Top"
                     Text="ROW"
                     Foreground="Red"
                     Margin="0,0,0,6"/>

          <!-- ✅ 여기입니다 -->
          <Button Classes="status"
                  DockPanel.Dock="Right"
                  Background="{Binding StatusColor,
                    Converter={StaticResource NotionColorToBrushConverter}}"
                  Content="{Binding Status}"
                  Click="StatusButton_Click"
                  PointerPressed="StatusButton_RightPressed"/>

          <!-- ✅ 체크박스 -->
          <CheckBox IsChecked="{Binding IsChecked}"
                    Background="Red"
                    VerticalAlignment="Center"
                    Margin="0,0,10,0"/>

          <!-- 체크리스트 제목 -->
          <TextBlock Text="{Binding Title}"
                     TextWrapping="Wrap"
                     Foreground="Black"
                     Margin="0,0,10,0"/>

        </DockPanel>
      </Border>

          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>

    </DockPanel>
  </Border>
</Window>
